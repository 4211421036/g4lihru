!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).vintagejs=e()}}((function(){return function e(t,n,r){function o(i,u){if(!n[i]){if(!t[i]){var l="function"==typeof require&&require;if(!u&&l)return l(i,!0);if(a)return a(i,!0);var f=new Error("Cannot find module '"+i+"'");throw f.code="MODULE_NOT_FOUND",f}var c=n[i]={exports:{}};t[i][0].call(c.exports,(function(e){var n=t[i][1][e];return o(n||e)}),c,c.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){if(null!=e)return e;throw new Error("Got unexpected null or undefined")}},{}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=e("./utils.js"),i={curves:!1,screen:!1,saturation:1,vignette:0,lighten:0,viewfinder:!1,sepia:!1,brightness:0,contrast:0},u=function(e){return e},l=function(e){return function(t){return e[t]}},f=function(e){var t=function(e){var t,n=e.curves,r=e.contrast,o=e.brightness,i=e.screen,f=(e.saturation,u),c=u,s=u;if(n&&(f=(0,a.compose)(l(n.r),f),c=(0,a.compose)(l(n.g),c),s=(0,a.compose)(l(n.b),s)),r){var d=function(e){return function(t){return 259*(256*e+255)/(255*(259-256*e))*(t-128)+128}}(r);f=(0,a.compose)(d,f),c=(0,a.compose)(d,c),s=(0,a.compose)(d,s)}if(o){var g=function(e){return function(t){return t+256*e}}(o);f=(0,a.compose)(g,f),c=(0,a.compose)(g,c),s=(0,a.compose)(g,s)}if(i){var m=(t=i.a,function(e){return function(n){return 255-(255-n)*(255-e*t)/255}});f=(0,a.compose)(m(i.r),f),c=(0,a.compose)(m(i.g),c),s=(0,a.compose)(m(i.b),s)}var p=(Uint8ClampedArray?new Uint8ClampedArray(256):new Array(256).fill(1)).map((function(e,t){return t}));return[p.map(f),p.map(c),p.map(s)]}(e);return function(n){var r=o(n,2),i=r[0],u=r[1];return new Promise((function(n,r){var l=i.width,f=i.height;u.globalCompositeOperation="multiply";for(var c="multiply"===u.globalCompositeOperation,s=u.getImageData(0,0,l,f),d=s.data.slice(0),g=e.sepia,m=e.saturation,p=d.length/4;p>=0;--p){var v=p<<2,h=v+1,y=v+2,C=t[0][d[v]],b=t[1][d[h]],w=t[2][d[y]];if(g){var x=[.393*C+.769*b+.189*w,.349*C+.686*b+.168*w,.272*C+.534*b+.131*w];C=x[0],b=x[1],w=x[2]}if(m<1){var I=(C+b+w)/3;C+=(I-C)*(1-m),b+=(I-b)*(1-m),w+=(I-w)*(1-m)}d[v]=C,d[h]=b,d[y]=w}return s.data.set(d),u.putImageData(s,0,0),e.vignette&&(u.globalCompositeOperation=c?"multiply":"source-over",u.fillStyle=(0,a.getGradient)(u,l,f,["rgba(0,0,0,0)","rgba(0,0,0,0)","rgba(0,0,0,"+e.vignette+")"]),u.fillRect(0,0,l,f)),e.lighten&&(u.globalCompositeOperation=c?"screen":"lighter",u.fillStyle=(0,a.getGradient)(u,l,f,["rgba(255,255,255,"+e.lighten+")","rgba(255,255,255,0)","rgba(0,0,0,0)"]),u.fillRect(0,0,l,f)),e.viewfinder?(0,a.loadImageWithCache)(e.viewfinder).then((function(e){if(c)u.globalCompositeOperation="multiply",u.drawImage(e,0,0,l,f);else{var t=(0,a.createCanvasAndCtxFromImage)(e,l,f),r=o(t,2),s=(r[0],r[1].getImageData(0,0,l,f).data),d=u.getImageData(0,0,l,f);d.data.set(d.data.map((function(e,t){return e*s[t]/255}))),u.putImageData(d,0,0)}return n((0,a.getResult)(i))})):n((0,a.getResult)(i))}))}};n.default=function(e,t){return("string"==typeof e?(0,a.loadImage)(e).then(a.getCanvasAndCtx):Promise.resolve((0,a.getCanvasAndCtx)(e))).then(f(r({},i,t)))},t.exports=n.default},{"./utils.js":3}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getResult=n.loadImageWithCache=n.loadImage=n.getGradient=n.getCanvasAndCtx=n.cloneCanvasAndCtx=n.createCanvasAndCtxFromImage=n.compose=void 0;var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=e("nullthrows"),i=(r=a)&&r.__esModule?r:{default:r};var u,l="image/jpeg",f=(n.compose=function(e,t){return function(n){return e(t(n))}},n.createCanvasAndCtxFromImage=function(e,t,n){var r=document.createElement("canvas");t||(t=e.width),n||(n=e.height),r.width=t,r.height=n;var o=(0,i.default)(r.getContext("2d"),"Could not get 2d context for canvas");return o.drawImage(e,0,0,t,n),[r,o]}),c=n.cloneCanvasAndCtx=function(e){var t=e.width,n=e.height,r=document.createElement("canvas"),o=(0,i.default)(r.getContext("2d"),"Could not get 2d context for canvas");return r.width=t,r.height=n,o.drawImage(e,0,0,t,n),[r,o]},s=(n.getCanvasAndCtx=function(e){if(e instanceof HTMLImageElement)return f(e);if(e instanceof HTMLCanvasElement)return c(e);throw new Error("Unsupported source element. Expected HTMLCanvasElement or HTMLImageElement, got "+(void 0===e?"undefined":o(e))+".")},n.getGradient=function(e,t,n,r){var o=e.createRadialGradient(t/2,n/2,0,t/2,n/2,Math.sqrt(Math.pow(t/2,2)+Math.pow(n/2,2)));return r.forEach((function(e,t,n){o.addColorStop(t/(n.length-1),e)})),o},n.loadImage=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=function(e){return n(e)},r.src=e}))});n.loadImageWithCache=(u={},function(e){return u[e]?Promise.resolve(u[e]):s(e).then((function(t){return u[e]=t,t}))}),n.getResult=function(e){return{getDataURL:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.toDataURL(t,n)},getCanvas:function(){return e},genImage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return s(e.toDataURL(t,n))}}}},{nullthrows:1}]},{},[2])(2)}));